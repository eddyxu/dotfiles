set nocompatible

filetype off
call pathogen#runtime_append_all_bundles()
call pathogen#helptags()

filetype on
filetype plugin on
set nobackup
set autowrite
set clipboard=unnamed
syntax on
set background=dark
let g:solarized_termtrans=1
colorscheme solarized
set statusline=%F%m%r%h%w\ [FORMAT=%{&ff},\ %{&fenc}]\ [TYPE=%Y]\ [ASCII=\%03.3b]\ [HEX=\%02.2B]\ [POS=%04l,%04v][%p%%]\ [LEN=%L]
set laststatus=2
set visualbell
set nohlsearch
set incsearch
set wildmenu
set wildmode=longest:full
set mouse=a
set lazyredraw
set number
set foldenable
set foldmethod=indent
set foldlevel=100
set foldopen-=search
set foldopen-=undo
set formatoptions=ro
set guioptions-=T " remove toolbar
set cindent
set autoindent
set smartindent
set tabstop=4
set softtabstop=4
set shiftwidth=4
set noexpandtab
set smarttab
set secure

" general settings
function RemoveTrailingWhitespace()
  if &ft != "diff"
    let b:curcol = col(".")
	let b:curline = line(".")
	silent! %s/\s\+$//
	silent! %s/\(\s*\n\)\+\%$//
    call cursor(b:curline, b:curcol)
  endif
endfunction
au BufWritePre * call RemoveTrailingWhitespace()

" Taglist
let Tlist_Sort_Type = "name" " order by
let Tlist_Use_Right_Window = 1 " split to the right side of the screen
let Tlist_Show_Menu = 1
let Tlist_Display_Prototype = 0
let Tlist_Exit_OnlyWindow = 1
let Tlist_File_Fold_Auto_Close = 1
let Tlist_Enable_Fold_Column = 0
"map <C-C> <ESC>:Tlist<RETURN>
set tags=~/.vim/tags,~/tags,./tags,../tags,../../tags
map <C-F12> :!ctags -R --c++-kinds=+p --fields=+iaS --extra=+q .<CR>

map <C-C> <ESC>:TagbarToggle<CR>

" for c/h switch
let g:alternateExtensions_h = "c,cpp,cc,m,inl"
let g:alternateExtensions_cpp = "h"
let g:alternateExtensions_c = "h"
let g:alternateExtensions_m = "h"
let g:alternateSearchPath = 'sfr:../source,sfr:../src,sfr:../include,sfr:../inc,reg:/include/src/g,reg:/src/include/g'
map <F3> <ESC>:A<CR>

" Supertab
let g:SuperTabDefaultCompletionType = "context"
set completeopt=menuone,longest,preview

" for NERDTree
map <C-X><C-C> <ESC>:NERDTree<RETURN>
let NERDTreeIgnore=['.*>o$', 'Makefile>in$', '.*>a$']

" autocomplet parenthess
:inoremap ( ()<ESC>i
		:inoremap ) <c-r>=ClosePair(')')<CR>
:inoremap { {}<ESC>i
:inoremap } <c-r>=ClosePair('}')<CR>
:inoremap [ []<ESC>i
:inoremap ] <c-r>=ClosePair(']')<CR>
":inoremap < <><ESC>i
":inoremap > <c-r>=ClosePair('>')<CR>

function ClosePair(char)
	if getline('.')[col('.') - 1] == a:char
		return "\<Right>"
	else
		return a:char
	endif
endfunction

autocmd BufEnter * :syntax sync fromstart

"map <C-B> <ESC>:e %:p:h<RETURN>
map <C-F4> <ESC>:bd<RETURN>
map <C-Left> <ESC>:bp!<RETURN>
map <C-Right> <ESC>:bn!<RETURN>

nmap <C-Down> :<C-u>move .+1<CR>
nmap <C-Up> :<C-u>move .-2<CR>

imap <C-Down> <C-o>:<C-u>move .+1<CR>
imap <C-Up> <C-o>:<C-u>move .-2<CR>

vmap <C-Down> :move '>+1<CR>gv
vmap <C-Up> :move '<-2<CR>gv


" Python settings
au FileType python set et tw=79 ts=4 sts=4 sw=4 autoindent sta
au FileType python set smartindent cinwords=if,elif,else,for,while,try,except,finally,def,class
au FileType python compiler nose
au BufNewFile *.py 0r ~/.vim/skeleton/py.py
let g:pydiction_location='~/.vim/ftplugin/complete-dict'
au FileType python set omnifunc=pythoncomplete#Complete
" pep8
let g:pep8_map='<leader>8'


" C/C++ settings
au FileType cpp set et sw=2 sts=2 cinoptions=l1,g0.5s,h0.5s,i2s,+2s,(0,W2s
au FileType c set et sw=4 sts=4 cinoptions=l1,g0.5s,h0.5s,i2s,+2s,(0,W2s
au FileType python set omnifunc=pythoncomplete#Complete
au BufNewFile *.cpp,*.h 0r ~/.vim/skeleton/cpp.cpp

" Use C++11 syntax
au BufNewFile,BufRead *.cpp set syntax=cpp11

" Protobuf syntax
augroup filetype
	au! BufRead,BufNewFile *.proto setfiletype proto
augroup end

" Coding style for Linux kernel development
if match(expand('%:p'), '^/.*/kernel/.*') == 0
	au FileType c set noet ts=8 sw=8 tw=78 ai si
	au FileType c set backspace=eol,start,indent
	au FileType c syn keyword cType uint ubyte ulong uint64_t uint32_t uint16_t
	au FileType c syn keyword uint8_t boolean_t int64_t int32_t int16_t int8_t
	au FileType c syn keyword u_int64_t u_int32_t u_int16_t u_int8_t
	au FileType c syn keyword cOperator likely unlikely
endif

au FileType tex,plaintex set nocindent spell

" Use tabs in makefiles
au FileType make,automake set noexpandtab ts=8 st=8 sw=8

" set for make
au BufEnter *_test.cpp set makeprg=make\ check\ %:r

" Support for [:VIM_EVAL:]foo[:END_EVAL:]
autocmd BufNewFile * %substitute#\[:VIM_EVAL:\]\(.\{-\}\)\[:END_EVAL:\]#\=eval(submatch(1))#ge

" Highlight a line if it exceeds 80 chars
"
if exists('+colorcolumn')
	set colorcolumn=80
else
	"" Vim <= 7.3
	au BufWinEnter * let w:m2=matchadd('ErrorMsg', '\%>80v.\+', -1)
endif

if filereadable(glob("~/.vimrc.local"))
    source ~/.vimrc.local
endif
